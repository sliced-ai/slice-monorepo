helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo update
helm install my-release bitnami/kafka -f /home/ec2-user/environment/infastructure/kafka/values.yaml
helm uninstall my-release

#########Setup EBS AWS Cluster
# 1.OIDC
cluster_name=slice-ai
oidc_id=$(aws eks describe-cluster --name $cluster_name --query "cluster.identity.oidc.issuer" --output text | cut -d '/' -f 5)
echo $oidc_id

#Check
aws iam list-open-id-connect-providers | grep $oidc_id | cut -d "/" -f4

#Create
eksctl utils associate-iam-oidc-provider --cluster $cluster_name --approve --region us-west-2

# 2. IAM Role
eksctl create iamserviceaccount --region us-west-2 --name ebs-csi-controller-sa \
--namespace kube-system --cluster slice-ai \
--attach-policy-arn arn:aws:iam::aws:policy/AmazonEBSCSIDriverPolicy --approve

#3. Install
eksctl create addon --name aws-ebs-csi-driver \
--cluster slice-ai \
--region us-west-2 \
--service-account-role-arn arn:aws:iam::805993730735:role/AmazonEKS_EBS_CSI_DriverRole --force


eks events:
kubectl get events --sort-by='.metadata.creationTimestamp'

kubectl get pvc data-my-release-kafka-controller-0

eksctl create iamserviceaccount \
    --name ebs-csi-controller-sa \
    --namespace kube-system \
    --cluster slice-ai \
    --role-name AmazonEKS_EBS_CSI_DriverRole \
    --role-only \
    --attach-policy-arn arn:aws:iam::aws:policy/service-role/AmazonEBSCSIDriverPolicy \
    --approve \
    --region us-west-2